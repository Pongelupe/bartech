<div class="container-fluid">
  <div class="row">
    <div class="col-md-7">
      <h4>Produtos cadastrados</h4>
      <div class="form-group">
        <label for="searchProducts">Pesquisar produtos</label>
        <input type="text" class="form-control" id="searchProducts" aria-describedby="searchProductsHelp" [(ngModel)]="termoPesquisaProduto">
        <small id="searchProductsHelp" class="form-text text-muted">Digite o nome ou código do produto</small>
      </div>
      <div class="row">
        <div class="col-4 mb-3" *ngFor="let produto of produtos$ | async | produto : [termoPesquisaProduto]">
          <app-bt-card [title]="produto.nome" [subtitle]="produto.preco" (click)="openModalItem(produto)"></app-bt-card>
        </div>
      </div>
    </div>
    <div class="col-md-5 mb-3">
      <div class="card">
        <h4 class="mt-1 text-center">Produtos adicionados na venda</h4>
        <app-itens-venda [itens]="venda.itensVenda" (itemRemoved)="onItemRemoved($event)"></app-itens-venda>
        <hr class="m-0" />
        <div class="col-12">
          <div class="row bg-success text-white font-weight-bold totais">
            <span class="col-6">Total </span>
            <span class="col-6 text-right">{{totalVenda | currency : 'BRL'}}</span>
          </div>
        </div>
      </div>
        <div class="row mt-1">
          <div class="col-6">
            <button type="button"
             class="btn btn-warning col-8"
             (click)="cancelVenda()"
             [disabled]="this.venda.itensVenda?.length !== 0">Cancelar</button>
          </div>
          <div class="col-6">
            <button type="button" class="btn btn-danger col-8 pull-right">Encerrar</button>
        </div>
      </div>
    </div>
  </div>
</div>

<ngx-smart-modal #addModal identifier="addModal" customClass="medium-modal">
  <h3 class="text-center">{{produto.nome}}</h3>
  <p>{{produto.nome}} possui {{produto.quantidadeEstoque}} itens tem estoque</p>
  <form [formGroup]="addForm" (submit)="addItemVenda()">
    <div class="form-group mt-1">
      <label>Quantidade</label>
      <input type="number" class="form-control" formControlName="quantidade" min="0" value="1" [max]="produto.quantidadeEstoque">
    </div>
    <span>
      <small class="text-danger d-block mt-2" *ngIf="addForm.get('quantidade').errors">A quantidade não pode ser
        {{addForm.get('quantidade').value}}</small>
    </span>

    <button type="submit" [disabled]="addForm.invalid" class="btn btn-primary mt-2 mr-2">Adicionar</button>
    <button type="button" (click)="addModal.close()" class="btn btn-danger mr-2 mt-2">Cancelar</button>
  </form>
</ngx-smart-modal>
